Сопрограмма – это в действительности генераторная функция, в теле которой имеется ключевое слово yield.

```python
# Переменную `readings` можно связать с объектом итератора или генератора, 
# отдающим элементы типа 
`float`: readings: Iterator[float]

# Переменную `sim_taxi` можно связать с сопрограммой, которая представляет 
# такси в алгоритме моделирования дискретных событий. Она отдает события, 
# получает временные метки типа `float` и возвращает количество поездок 
# за время моделирования: 
sim_taxi: Generator[Event, float, int]
```

формальные параметры-типы Generator описаны следующим образом: 
```python
Generator[YieldType, SendType, ReturnType]
```
![[Pasted image 20240404220036.png]]
![[Pasted image 20240404220149.png]]
сопрограмма для вычисления накопительного среднего:
```python
from collections.abc import Generator 

def averager() -> Generator[float, float, None]: 
	total = 0.0 
	count = 0 
	average = 0.0 
	while True: 
		term = yield average 
		total += term 
		count += 1 
		average = total / count
```
В этом тесте вызов next(coro_avg) заставляет сопрограмму дойти до yield, при этом будет отдано начальное значение average. Запустить сопрограмму можно также, вызвав coro_avg.send(None), – именно так и поступает встроенная функция next(). Но отправить какое-то значение, кроме None, нельзя, потому что сопрограмма может принимать отправленные значения, только когда приостановлена в точке yield. Вызов next() или .send(None), чтобы продвинуть выполнение к первому предложению yield, называется «инициализацией сопрограммы».
После каждой активации сопрограмма приостанавливается на выражении yield и ждет отправки значения. В строке coro_avg.send(10) значение отправляется, после чего сопрограмма активируется. Выражение yield отдает значение 10, которое присваивается переменной term. В оставшейся части цикла обновляются переменные total, count и average. На следующей итерации цикла while отдается значение average, и сопрограмма снова приостанавливается в точке yield. У внимательного читателя, наверное, возник вопрос, как остановить работу объекта averager (coro_avg), – ведь цикл-то бесконечный. Обычно нам не нужно завершать генератор, потому что сборщик мусора позаботится о нем, как только на него не останется ни одной ссылки. Если все-таки необходимо завершить генератор явно, воспользуйтесь методом .close(),
